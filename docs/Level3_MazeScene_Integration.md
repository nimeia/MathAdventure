# 第三关：加减法迷宫 - 集成说明

## 📁 新增文件

### 场景文件
- `scenes/MazeScene.tscn` - 第三关主场景

### 脚本文件
- `scripts/MazeScene.gd` - 第三关逻辑脚本

## 🎮 功能实现

### ✅ 已完成功能

1. **题目生成系统**
   - 100以内加减法题目自动生成
   - 加法：确保结果 ≤ 99
   - 减法：确保结果 ≥ 0
   - 错误答案与正确答案差值控制在 1-20

2. **玩家交互**
   - 点击按钮选择答案
   - 键盘数字键 1-3 快速选择
   - 答对：小勇士前进动画 + 道路变绿
   - 答错：小勇士后退动画 + 道路变红

3. **时间机制**
   - 每题8秒倒计时（复用 TimerManager）
   - 倒计时条实时显示
   - 超时自动判错

4. **奖励系统**
   - 基础奖励：答对 +2 金币
   - 快速奖励：5秒内答对额外 +1 金币
   - 连击奖励：连续5题触发宝箱（+10金币 + 装备）

5. **通关条件**
   - 答对5道题即可通关
   - 获得地图碎片
   - 自动解锁下一关（保存到 level 4）

## 🔧 与现有系统的集成

### 复用的全局系统

1. **TimerManager（健康时长控制）**
   - 自动连接游戏时间更新信号
   - 游戏时间到自动跳转休息界面
   - 保存/加载游戏进度

2. **金币系统**
   - 从 TimerManager 加载已有金币
   - 更新后保存到全局进度

3. **场景跳转**
   - 通关后返回主菜单
   - 休息时间到跳转休息界面

## 📋 场景节点结构

```
MazeScene (Control)
├── Background (ColorRect)
├── UI (Control)
│   ├── TopPanel
│   │   ├── CoinLabel - 显示金币
│   │   └── GameTimerLabel - 显示游戏时间
│   ├── MazeArea
│   │   ├── PlayerSprite - 小勇士 🧙‍♂️
│   │   └── PathContainer
│   │       ├── Path1 - 路径1 🛤️
│   │       ├── Path2 - 路径2 🛤️
│   │       └── Path3 - 路径3 🛤️
│   ├── QuestionArea
│   │   ├── QuestionLabel - 题目显示
│   │   ├── TimerContainer
│   │   │   ├── TimerBar - 倒计时条
│   │   │   └── TimerLabel - 倒计时数字
│   │   └── AnswerContainer
│   │       ├── AnswerBtn1 - 选项1
│   │       ├── AnswerBtn2 - 选项2
│   │       └── AnswerBtn3 - 选项3
│   ├── FeedbackLabel - 反馈信息
│   └── LevelCompletePopup - 通关弹窗
└── Audio
    ├── CorrectSound
    ├── WrongSound
    └── TimeoutSound
```

## 🚀 如何添加到主菜单

在主菜单的关卡选择中添加第三关按钮，按钮点击后调用：

```gdscript
get_tree().change_scene_to_file("res://scenes/MazeScene.tscn")
```

## 🎯 测试要点

1. **题目生成**
   - 验证加法结果不超过99
   - 验证减法结果不为负数
   - 错误选项合理性

2. **交互响应**
   - 按钮点击正常
   - 键盘输入正常
   - 动画效果流畅

3. **奖励计算**
   - 金币正确累加
   - 连击正确计数
   - 宝箱触发正常

4. **系统集成**
   - 健康时长正常工作
   - 进度正确保存
   - 场景切换正常

## 📝 注意事项

1. 场景文件已创建但需要在 Godot 编辑器中调整节点布局
2. 音效文件需要另外添加并连接到 AudioStreamPlayer 节点
3. 可以根据需要调整游戏常量（在脚本开头定义）

## 🔄 后续优化建议

1. 添加更多迷宫路径分支
2. 增加题目难度递增机制
3. 添加道具系统（如时间延长道具）
4. 优化动画效果和视觉反馈
5. 添加背景音乐和更多音效