# MazeScene 题目生成功能测试指南

## 📝 功能概述

MazeScene.gd 现在包含了完整的100以内加减法题目生成系统，具有以下特性：

### ✅ 核心功能
1. **随机生成加法或减法题目**（50%概率）
2. **加法题目**：确保结果 ≤ 99
3. **减法题目**：确保结果 ≥ 0
4. **错误答案生成**：与正确答案差值在 1-20 之间
5. **答案数量**：1个正确答案 + 1-2个错误答案
6. **随机分配**：答案随机分配到 AnswerBtn1、AnswerBtn2、AnswerBtn3

## 🔧 关键函数说明

### 1. `generate_new_question()`
主函数，负责：
- 随机选择题目类型（加法/减法）
- 调用相应的题目生成函数
- 生成答案选项
- 显示题目到 QuestionLabel
- 随机分配答案到按钮

### 2. `generate_addition_question()`
生成加法题目：
```gdscript
var a = randi_range(0, 99)
var max_b = 99 - a  # 确保 a + b <= 99
var b = randi_range(0, max_b)
```

### 3. `generate_subtraction_question()`
生成减法题目：
```gdscript
var a = randi_range(0, 99)
var b = randi_range(0, a)  # 确保 a - b >= 0
```

### 4. `generate_answer_options(correct_answer)`
生成答案选项：
- 添加正确答案
- 生成 1-2 个错误答案
- 确保总共有 3 个选项
- 错误答案与正确答案差值控制在 1-20

### 5. `assign_answers_to_buttons(options)`
将答案随机分配到按钮：
- 打乱选项顺序
- 分配到 AnswerBtn1、AnswerBtn2、AnswerBtn3
- 控制台输出分配结果

## 🧪 测试步骤

### 1. 基础测试
```gdscript
# 在 _ready() 函数中添加测试代码
func _ready():
    # ... 原有代码 ...
    
    # 测试题目生成
    for i in range(5):
        print("\n测试第 %d 题：" % (i+1))
        generate_new_question()
```

### 2. 边界测试
测试以下边界情况：
- 0 + 99 = 99（最大加法）
- 99 - 99 = 0（最小结果）
- 0 + 0 = 0（最小加法）
- 99 - 0 = 99（最大结果）

### 3. 错误答案验证
检查生成的错误答案是否满足：
- 在 0-99 范围内
- 不等于正确答案
- 与正确答案差值在 1-20 之间
- 不重复

## 📊 控制台输出示例

运行时会看到类似输出：
```
===== 生成第 1 题 =====
题目类型: 加法
算式: 45 + 23 = ?
正确答案: 68
将生成 2 个错误答案
  生成错误答案: 73 (差值: 5)
  生成错误答案: 58 (差值: -10)
生成的选项（打乱前）: [68, 73, 58]
  按钮1: 58
  按钮2: 68
  按钮3: 73
答案已随机分配到按钮
```

## 🐛 常见问题排查

### 问题1：错误答案生成失败
**原因**：正确答案太接近边界（如 0 或 99）
**解决**：使用备用方案 `generate_fallback_wrong_answers()`

### 问题2：按钮显示不正确
**检查**：
- 确保 AnswerBtn1、AnswerBtn2、AnswerBtn3 节点存在
- 检查 answer_buttons 数组是否正确初始化

### 问题3：题目显示不正确
**检查**：
- 确保 QuestionLabel 节点存在
- 检查 question_label 变量是否正确赋值

## 🎮 集成测试

在 Godot 编辑器中：
1. 打开 MazeScene.tscn
2. 运行场景（F6）
3. 观察控制台输出
4. 检查界面显示：
   - QuestionLabel 显示算式
   - AnswerBtn1~3 显示答案选项
   - 点击按钮验证答案判断

## 📈 性能优化建议

1. **缓存题目**：可以预生成一批题目，避免实时计算
2. **难度递增**：根据答题情况调整数字范围
3. **题目去重**：记录已出现的题目，避免重复

## 🔄 扩展建议

1. **增加题目类型**：
   - 连续加法（如 20 + 30 + 15）
   - 混合运算

2. **难度分级**：
   - 简单：0-30
   - 中等：30-60
   - 困难：60-99

3. **特殊题目**：
   - 整十数运算
   - 进位/借位专项练习