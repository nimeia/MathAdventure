# MazeScene å€’è®¡æ—¶ç³»ç»Ÿæµ‹è¯•éªŒè¯æŒ‡å—

## âœ… å·²å®ç°çš„å€’è®¡æ—¶åŠŸèƒ½

### 1. **8ç§’å€’è®¡æ—¶** âœ“
- æ¯é“é¢˜ç›®è‡ªåŠ¨å¼€å§‹8ç§’å€’è®¡æ—¶
- å¸¸é‡å®šä¹‰ï¼š`const QUESTION_TIME = 8.0`

### 2. **ProgressBaræ˜¾ç¤º** âœ“
- TimerBar å®æ—¶æ˜¾ç¤ºå‰©ä½™æ—¶é—´
- é¢œè‰²å˜åŒ–è­¦å‘Šç³»ç»Ÿ

### 3. **è¶…æ—¶è‡ªåŠ¨åˆ¤é”™** âœ“
- æ—¶é—´åˆ°è‡ªåŠ¨è§¦å‘ `handle_timeout()`
- åˆ¤å®šä¸ºé”™è¯¯å¹¶ç”Ÿæˆæ–°é¢˜ç›®

### 4. **UIçŠ¶æ€é‡ç½®** âœ“
- `clear_ui_state()` å‡½æ•°æ¸…ç©ºæ‰€æœ‰UI
- å€’è®¡æ—¶é‡ç½®æ—¶æ¢å¤åˆå§‹çŠ¶æ€

## ğŸ“Š å®ç°ä»£ç ä½ç½®

### å€’è®¡æ—¶æ ¸å¿ƒä»£ç 
```gdscript
# æ–‡ä»¶ï¼šscripts/MazeScene.gd

# ç¬¬677-686è¡Œï¼šæ¯å¸§æ›´æ–°å€’è®¡æ—¶
func _process(delta):
    if is_waiting_answer and countdown_timer > 0:
        countdown_timer -= delta
        update_timer_display()
        
        if countdown_timer <= 0:
            countdown_timer = 0
            handle_timeout()

# ç¬¬688-723è¡Œï¼šæ›´æ–°æ˜¾ç¤º
func update_timer_display():
    # æ›´æ–°ProgressBar
    if timer_bar:
        timer_bar.value = countdown_timer
        # é¢œè‰²å˜åŒ–...
    
    # æ›´æ–°Label
    if timer_label:
        timer_label.text = str(time_left)
        # é—ªçƒæ•ˆæœ...

# ç¬¬457-484è¡Œï¼šè¶…æ—¶å¤„ç†
func handle_timeout():
    is_waiting_answer = false
    streak_count = 0
    # ç¦ç”¨æŒ‰é’®
    # æ˜¾ç¤ºåé¦ˆ
    # ç”Ÿæˆæ–°é¢˜ç›®...

# ç¬¬621-637è¡Œï¼šé‡ç½®å€’è®¡æ—¶
func reset_timer():
    countdown_timer = QUESTION_TIME
    is_waiting_answer = true
    # é‡ç½®UI...
```

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æµ‹è¯•1ï¼šåŸºæœ¬å€’è®¡æ—¶
1. è¿è¡Œåœºæ™¯
2. è§‚å¯ŸTimerBarä»æ»¡åˆ°ç©ºï¼ˆ8ç§’ï¼‰
3. æ£€æŸ¥æ•°å­—ä»8é€’å‡åˆ°0

**é¢„æœŸç»“æœ**ï¼š
- âœ… ProgressBarå¹³æ»‘å‡å°‘
- âœ… æ•°å­—å‡†ç¡®æ˜¾ç¤ºå‰©ä½™ç§’æ•°

### æµ‹è¯•2ï¼šé¢œè‰²è­¦å‘Š
1. è§‚å¯Ÿå€’è®¡æ—¶è¿‡ç¨‹ä¸­çš„é¢œè‰²å˜åŒ–

**é¢„æœŸç»“æœ**ï¼š
- âœ… 8-5ç§’ï¼šç»¿è‰²
- âœ… 5-3ç§’ï¼šé»„è‰²
- âœ… 3-0ç§’ï¼šçº¢è‰²+é—ªçƒ

### æµ‹è¯•3ï¼šè¶…æ—¶å¤„ç†
1. ç­‰å¾…8ç§’ä¸ç­”é¢˜
2. è§‚å¯Ÿè¶…æ—¶åçš„è¡Œä¸º

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ˜¾ç¤º"â° æ—¶é—´åˆ°ï¼"
- âœ… æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
- âœ… è·¯å¾„å˜é»„åŠ¨ç”»
- âœ… 2ç§’åè‡ªåŠ¨ç”Ÿæˆæ–°é¢˜

### æµ‹è¯•4ï¼šç­”é¢˜ä¸­æ–­å€’è®¡æ—¶
1. åœ¨å€’è®¡æ—¶è¿›è¡Œä¸­ç‚¹å‡»ç­”æ¡ˆ

**é¢„æœŸç»“æœ**ï¼š
- âœ… å€’è®¡æ—¶ç«‹å³åœæ­¢
- âœ… è¿›å…¥ç­”æ¡ˆåˆ¤å®šæµç¨‹

### æµ‹è¯•5ï¼šé”™è¯¯åé‡ç½®
1. ç­”é”™ä¸€é¢˜
2. è§‚å¯Ÿå€’è®¡æ—¶æ˜¯å¦é‡æ–°å¼€å§‹

**é¢„æœŸç»“æœ**ï¼š
- âœ… å€’è®¡æ—¶é‡ç½®ä¸º8ç§’
- âœ… TimerBaræ¢å¤æ»¡å€¼
- âœ… å¯ä»¥é‡æ–°ç­”é¢˜

## ğŸ® å®Œæ•´æ¸¸æˆæµç¨‹éªŒè¯

```mermaid
graph LR
    A[ç”Ÿæˆé¢˜ç›®] --> B[reset_timer]
    B --> C[8ç§’å€’è®¡æ—¶å¼€å§‹]
    C --> D{ç©å®¶æ“ä½œ}
    D -->|ç‚¹å‡»ç­”æ¡ˆ| E[stop_timer]
    D -->|ç­‰å¾…8ç§’| F[handle_timeout]
    E --> G[åˆ¤æ–­å¯¹é”™]
    F --> H[æ˜¾ç¤ºè¶…æ—¶]
    G -->|æ­£ç¡®| I[ä¸‹ä¸€é¢˜]
    G -->|é”™è¯¯| J[reset_timeré‡è¯•]
    H --> K[clear_ui_state]
    K --> I
    I --> A
```

## ğŸ“ æ§åˆ¶å°è¾“å‡ºéªŒè¯

è¿è¡Œæ¸¸æˆæ—¶åº”çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š

```
===== ç”Ÿæˆç¬¬ 1 é¢˜ =====
é¢˜ç›®ç±»å‹: åŠ æ³•
ç®—å¼: 45 + 23 = ?
æ­£ç¡®ç­”æ¡ˆ: 68
å€’è®¡æ—¶å·²é‡ç½®ï¼š8ç§’

[ç­‰å¾…8ç§’ä¸æ“ä½œ]

â° ç­”é¢˜è¶…æ—¶ï¼
å€’è®¡æ—¶å·²åœæ­¢
UIçŠ¶æ€å·²æ¸…ç©º

===== ç”Ÿæˆç¬¬ 2 é¢˜ =====
å€’è®¡æ—¶å·²é‡ç½®ï¼š8ç§’
```

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šå€’è®¡æ—¶ä¸å·¥ä½œ
**æ£€æŸ¥**ï¼š
- `is_waiting_answer` æ˜¯å¦ä¸º true
- `_process()` å‡½æ•°æ˜¯å¦æ­£å¸¸æ‰§è¡Œ

### é—®é¢˜2ï¼šProgressBarä¸æ›´æ–°
**æ£€æŸ¥**ï¼š
- `timer_bar` èŠ‚ç‚¹æ˜¯å¦æ­£ç¡®è¿æ¥
- `timer_bar.max_value` æ˜¯å¦è®¾ç½®ä¸º8

### é—®é¢˜3ï¼šè¶…æ—¶ä¸è§¦å‘
**æ£€æŸ¥**ï¼š
- `countdown_timer` æ˜¯å¦æ­£ç¡®é€’å‡
- `handle_timeout()` å‡½æ•°æ˜¯å¦è¢«è°ƒç”¨

## âš™ï¸ é›†æˆéªŒè¯

### ä¸ TimerManager çš„é…åˆ
è™½ç„¶é¢˜ç›®å€’è®¡æ—¶æ˜¯ç‹¬ç«‹çš„ï¼Œä½†è¦ç¡®ä¿ï¼š
1. TimerManager æ§åˆ¶æ€»æ¸¸æˆæ—¶é—´ï¼ˆ10åˆ†é’Ÿï¼‰
2. MazeScene æ§åˆ¶å•é¢˜æ—¶é—´ï¼ˆ8ç§’ï¼‰
3. ä¸¤è€…ä¸å†²çª

### æµ‹è¯•ä»£ç 
```gdscript
# åœ¨ _ready() ä¸­æ·»åŠ æµ‹è¯•
func _ready():
    # ... åŸæœ‰ä»£ç  ...
    
    # æµ‹è¯•å€’è®¡æ—¶
    print("å€’è®¡æ—¶ç³»ç»Ÿæµ‹è¯•:")
    print("- QUESTION_TIME: ", QUESTION_TIME)
    print("- timer_bar exists: ", timer_bar != null)
    print("- timer_label exists: ", timer_label != null)
```

## âœ… åŠŸèƒ½éªŒè¯æ¸…å•

- [x] 8ç§’å€’è®¡æ—¶å®ç°
- [x] ProgressBarå®æ—¶æ›´æ–°
- [x] é¢œè‰²å˜åŒ–è­¦å‘Šï¼ˆç»¿â†’é»„â†’çº¢ï¼‰
- [x] æœ€å3ç§’é—ªçƒæ•ˆæœ
- [x] è¶…æ—¶è‡ªåŠ¨åˆ¤é”™
- [x] è¶…æ—¶åç”Ÿæˆæ–°é¢˜
- [x] ç­”é¢˜åœæ­¢å€’è®¡æ—¶
- [x] é”™è¯¯åé‡ç½®å€’è®¡æ—¶
- [x] UIçŠ¶æ€å®Œæ•´æ¸…ç©º
- [x] ä¸TimerManagerå…¼å®¹

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å‡å°‘æ›´æ–°é¢‘ç‡**
```gdscript
# å¯ä»¥é™åˆ¶æ›´æ–°é¢‘ç‡
if int(countdown_timer * 10) != int(last_timer * 10):
    update_timer_display()
```

2. **ç¼“å­˜èŠ‚ç‚¹å¼•ç”¨**
```gdscript
# é¿å…æ¯å¸§æŸ¥æ‰¾èŠ‚ç‚¹
@onready var cached_timer_bar = $UI/QuestionArea/TimerContainer/TimerBar
```

3. **æ¡ä»¶æ£€æŸ¥ä¼˜åŒ–**
```gdscript
# æå‰è¿”å›å‡å°‘åµŒå¥—
if not is_waiting_answer or countdown_timer <= 0:
    return
```

## ğŸ“‹ æ€»ç»“

å€’è®¡æ—¶ç³»ç»Ÿå·²å®Œæ•´å®ç°æ‰€æœ‰éœ€æ±‚ï¼š
1. âœ… 8ç§’å€’è®¡æ—¶
2. âœ… ProgressBaræ˜¾ç¤º
3. âœ… è¶…æ—¶è‡ªåŠ¨åˆ¤é”™
4. âœ… UIçŠ¶æ€é‡ç½®

ç³»ç»Ÿè¿è¡Œç¨³å®šï¼Œè§†è§‰åé¦ˆæ¸…æ™°ï¼Œä¸ç°æœ‰ç³»ç»Ÿå®Œç¾é›†æˆï¼