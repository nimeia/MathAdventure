# MazeScene 答题判定逻辑实现说明

## ✅ 已实现功能

### 1. 答案检测机制
当玩家点击任意答案按钮时：
- 获取按钮上显示的数字
- 与 `current_question.answer` 比较
- 判断正确或错误并执行相应逻辑

### 2. 正确答案处理
```gdscript
func handle_correct_answer(answer_time: float, button_index: int)
```

#### 金币奖励系统
- **基础奖励**：答对 +2 金币
- **快速答题奖励**：≤5秒额外 +1 金币
- **自动保存**：通过 TimerManager 保存进度

#### 视觉反馈
- **按钮动画**：选中按钮闪烁绿色（2次）
- **路径动画**：路径变绿并放大缩小
- **反馈文字**：显示"✅ 回答正确！+X 金币"
- **玩家动画**：小勇士前进

#### 流程控制
- 等待2秒动画完成
- 自动生成下一题
- 检查是否完成所有题目

### 3. 错误答案处理
```gdscript
func handle_wrong_answer(button_index: int)
```

#### 视觉反馈
- **按钮动画**：选中按钮闪烁红色（2次）
- **路径动画**：路径变红
- **反馈文字**：显示"❌ 答错了！再试一次"
- **提示信息**：显示正确答案
- **玩家动画**：小勇士后退

#### 流程控制
- 重置连击计数
- 等待1.5秒
- 重新启用所有按钮
- 重置倒计时（8秒）
- 玩家可以重新答题

### 4. 动画效果函数

#### 按钮动画
```gdscript
animate_button_correct(button)  # 绿色闪烁
animate_button_wrong(button)    # 红色闪烁
```

#### 路径动画
```gdscript
animate_paths_correct()  # 路径变绿 🟢
animate_paths_wrong()    # 路径变红 🔴
```

## 📊 控制台输出示例

### 正确答题
```
===== 答题判定 =====
选择的答案: 42
正确答案: 42
答题用时: 3.2 秒
✅ 答案正确！
快速答题！额外奖励 1 金币
获得金币: 3 (总金币: 15)

当前进度: 2/5 题
生成下一题...
```

### 错误答题
```
===== 答题判定 =====
选择的答案: 45
正确答案: 42
答题用时: 4.1 秒
❌ 答案错误！
答错了！正确答案是 42，请再试一次
```

## 🎮 游戏流程

```mermaid
graph TD
    A[玩家点击按钮] --> B{判断答案}
    B -->|正确| C[金币+2]
    C --> D{时间≤5秒?}
    D -->|是| E[额外+1金币]
    D -->|否| F[无额外奖励]
    E --> G[绿色动画]
    F --> G
    G --> H[生成下一题]
    
    B -->|错误| I[红色动画]
    I --> J[显示"再试一次"]
    J --> K[重置倒计时]
    K --> L[启用按钮]
    L --> M[等待玩家重新答题]
```

## 🔧 代码集成点

### 与 TimerManager 集成
```gdscript
# 保存进度
if TimerManager:
    TimerManager.update_game_progress(3, total_coins, correct_count)
```

### 与全局金币系统集成
```gdscript
# 更新金币
total_coins += total_reward
update_coin_display()
```

## 🐛 测试要点

### 1. 金币计算测试
- 答对基础题目：应获得 2 金币
- 5秒内答对：应获得 3 金币
- 多次答题：金币应累加

### 2. 动画效果测试
- 按钮颜色变化是否正确
- 路径动画是否流畅
- 动画结束后颜色是否恢复

### 3. 流程测试
- 答错后能否重新答题
- 答对后是否自动下一题
- 完成5题后是否触发通关

### 4. 边界测试
- 快速连续点击按钮
- 在动画期间点击
- 倒计时结束前答题

## 📝 使用示例

在 Godot 编辑器中运行场景后：

1. **观察题目**：查看 QuestionLabel 显示的算式
2. **选择答案**：点击 AnswerBtn1、2 或 3
3. **查看反馈**：
   - 正确：按钮和路径变绿，获得金币
   - 错误：按钮和路径变红，提示再试一次
4. **继续答题**：
   - 正确后自动下一题
   - 错误后重新答当前题

## 🎯 优化建议

1. **音效增强**：为不同情况添加不同音效
2. **连击系统**：连续答对给予额外奖励
3. **难度递增**：根据答题速度调整难度
4. **成就系统**：如"速度之王"、"完美通关"等