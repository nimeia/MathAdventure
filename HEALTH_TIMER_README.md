# 健康游戏时长控制功能 - 使用说明

## 📋 功能概述

本功能为"MathAdventure"游戏添加了健康的游戏时长控制机制，帮助玩家养成良好的游戏习惯，保护视力健康。

## 🎯 功能特性

### 基本规则
- **游戏时长限制**: 单次游戏时间最长 10 分钟
- **强制休息**: 时间到后自动进入休息状态
- **休息时长**: 必须休息 10 分钟才能继续游戏
- **进度保存**: 自动保存当前游戏进度

### 用户界面
- **游戏计时器**: 顶部显示剩余游戏时间（格式：09:59）
- **颜色提醒**: 
  - 正常时间：白色
  - 最后3分钟：黄色
  - 最后1分钟：红色
- **休息界面**: 专门的休息倒计时界面
- **健康提示**: 休息期间显示健康小贴士

## 🏗️ 技术架构

### 文件结构
```
MathAdventure/
├── scripts/
│   ├── TimerManager.gd          # 核心单例脚本
│   ├── RestScreen.gd            # 休息界面脚本
│   ├── GameManager.gd           # 主游戏管理器（已修改）
│   └── DebugHealthTimer.gd      # 调试测试脚本
├── scenes/
│   ├── RestScreen.tscn          # 休息界面场景
│   └── DebugScene.tscn          # 调试测试场景
└── main.tscn                    # 主游戏场景（已修改）
```

### 核心组件

#### 1. TimerManager（单例）
- **功能**: 管理游戏时长和休息时间的核心逻辑
- **状态管理**: PLAYING、TIME_UP、RESTING、REST_COMPLETE
- **数据持久化**: 保存计时器状态和游戏进度
- **信号系统**: 提供状态变化和时间更新的信号

#### 2. RestScreen（休息界面）
- **倒计时显示**: 实时显示休息剩余时间
- **进度条**: 可视化休息进度
- **健康提示**: 显示护眼和健康建议
- **状态管理**: 处理休息完成后的界面切换

#### 3. GameManager（游戏管理器集成）
- **时长监控**: 集成健康时长控制功能
- **控制禁用**: 时间到后禁用所有游戏操作
- **进度保存**: 自动保存当前游戏状态
- **状态恢复**: 重新进入游戏时恢复进度

## ⚙️ 配置参数

### 时长常量（可在 TimerManager.gd 中修改）
```gdscript
const GAME_TIME_LIMIT = 600.0      # 10分钟游戏时长
const REST_TIME_REQUIRED = 600.0   # 10分钟休息时长
```

### 保存路径
```gdscript
const SAVE_FILE_PATH = "user://game_progress.save"     # 游戏进度
const TIMER_SAVE_PATH = "user://timer_state.save"      # 计时器状态
```

## 🚀 使用流程

### 1. 正常游戏流程
1. 启动游戏 → 检查是否在休息期间
2. 开始游戏 → 启动10分钟倒计时
3. 游戏过程中 → 顶部显示剩余时间
4. 时间到 → 自动保存进度，跳转休息界面
5. 休息完成 → 可以继续游戏

### 2. 休息期间行为
- **游戏控制**: 完全禁用所有游戏操作
- **按键响应**: 显示"请继续休息"提示
- **界面显示**: 休息倒计时和健康提示
- **状态持久化**: 即使关闭游戏也会记住休息状态

### 3. 进度恢复机制
- **自动保存**: 时间到时自动保存关卡和金币
- **状态恢复**: 重新启动游戏时恢复之前的进度
- **离线休息**: 关闭游戏期间的时间也会计入休息时间

## 🔧 调试和测试

### 调试场景
运行 `scenes/DebugScene.tscn` 进入调试模式

### 调试快捷键
- **F1**: 设置游戏时间为30秒（快速测试）
- **F2**: 设置休息时间为30秒（快速测试）
- **F3**: 强制触发休息模式
- **F4**: 完成休息时间
- **F5**: 重置计时器为新游戏
- **F12**: 在控制台打印当前状态

### 测试建议
1. **正常流程测试**: F1设置30秒游戏时间，等待自动进入休息
2. **休息功能测试**: F2设置30秒休息时间，观察倒计时
3. **状态持久化测试**: 在休息期间关闭游戏，重新启动检查状态
4. **进度保存测试**: 时间到后检查关卡和金币是否保存

## 📝 验证清单

### ✅ 基本功能验证
- [ ] 游戏启动时显示计时器
- [ ] 时间到时自动进入休息界面
- [ ] 休息期间禁用所有游戏操作
- [ ] 休息完成后可以继续游戏
- [ ] 进度数据正确保存和恢复

### ✅ 边界情况验证
- [ ] 游戏启动时检查是否在休息期间
- [ ] 休息期间重启游戏的状态恢复
- [ ] 离线时间计入休息时间的计算
- [ ] 异常情况下的状态重置

### ✅ 用户体验验证
- [ ] 时间提醒的颜色变化清晰可见
- [ ] 休息界面的提示信息友好易懂
- [ ] 按键被禁用时有明确的反馈
- [ ] 界面切换流畅无卡顿

## 🛠️ 常见问题

### Q1: 如何修改游戏时长限制？
A1: 修改 `TimerManager.gd` 中的 `GAME_TIME_LIMIT` 常量。

### Q2: 如何跳过休息时间（仅调试用）？
A2: 运行调试场景，按F4键或点击"完成休息"按钮。

### Q3: 游戏数据保存在哪里？
A3: 保存在Godot的用户数据目录，通常在：
- Windows: `%APPDATA%/Godot/app_userdata/MathAdventure/`
- macOS: `~/Library/Application Support/Godot/app_userdata/MathAdventure/`
- Linux: `~/.local/share/godot/app_userdata/MathAdventure/`

### Q4: 如何重置所有数据？
A4: 删除用户数据目录中的 `.save` 文件，或使用调试功能重置。

## 📈 未来扩展建议

1. **个性化设置**: 允许家长设置不同的时长限制
2. **统计功能**: 记录每日游戏时长和休息统计
3. **奖励机制**: 良好的时间管理习惯给予额外奖励
4. **家长控制**: 添加家长监控和设置界面
5. **健康提醒**: 更丰富的护眼和健康建议内容

---

**注意**: 这个功能旨在培养健康的游戏习惯，特别适合儿童用户。在生产环境中部署前，建议进行充分的测试和用户反馈收集。